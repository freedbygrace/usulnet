// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
// SPDX-License-Identifier: AGPL-3.0-or-later

// Copyright (c) 2024-2026 usulnet contributors

// https://github.com/fr4nsys/usulnet

package enterprise

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import "github.com/fr4nsys/usulnet/internal/web/templates/layouts"

// RuntimeSecurityData holds data for the runtime security page.
type RuntimeSecurityData struct {
	PageData layouts.PageData
}

func RuntimeSecurity(data RuntimeSecurityData) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div x-data=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var3 string
			templ_7745c5c3_Var3, templ_7745c5c3_Err = templ.JoinStringErrs(runtimeSecAlpineInit(data.PageData.CSRFToken))
			if templ_7745c5c3_Err != nil {
				return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/web/templates/pages/enterprise/runtime_security.templ`, Line: 17, Col: 57}
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var3))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "\" x-init=\"init()\" class=\"space-y-6\"><!-- Header --><div class=\"flex items-center justify-between\"><div><h1 class=\"text-2xl font-display font-bold text-white\">Runtime Security</h1><p class=\"text-gray-400 mt-1\">Monitor container runtime behavior and detect anomalous activity</p></div><div class=\"flex items-center gap-2\"><button @click=\"seedRules()\" :disabled=\"seedingRules\" class=\"btn-secondary flex items-center gap-2\"><i class=\"fas fa-database\" :class=\"seedingRules && 'animate-spin'\"></i> <span x-text=\"seedingRules ? 'Seeding...' : 'Seed Default Rules'\"></span></button> <button @click=\"monitorAll()\" :disabled=\"monitoring\" class=\"btn-primary flex items-center gap-2\"><i class=\"fas fa-radar\" :class=\"monitoring && 'animate-spin'\"></i> <span x-text=\"monitoring ? 'Monitoring...' : 'Monitor All Containers'\"></span></button></div></div><!-- Loading State --><div x-show=\"loadingDashboard\" class=\"card p-12 text-center\"><i class=\"fas fa-spinner fa-spin text-2xl text-primary-400 mb-4\"></i><p class=\"text-gray-400\">Loading security dashboard...</p></div><!-- Dashboard Stats --><div x-show=\"!loadingDashboard\" x-cloak class=\"grid grid-cols-2 md:grid-cols-4 gap-4\"><div class=\"card p-3 text-center\"><i class=\"fas fa-bell text-primary-400 text-lg mb-1\"></i><p class=\"text-xl font-bold text-white\" x-text=\"dashboard.total_events || 0\"></p><p class=\"text-xs text-gray-400\">Total Events</p></div><div class=\"card p-3 text-center\"><i class=\"fas fa-exclamation-circle text-red-400 text-lg mb-1\"></i><p class=\"text-xl font-bold text-white\" x-text=\"(dashboard.severity_counts && dashboard.severity_counts.critical) || 0\"></p><p class=\"text-xs text-gray-400\">Critical</p></div><div class=\"card p-3 text-center\"><i class=\"fas fa-exclamation-triangle text-orange-400 text-lg mb-1\"></i><p class=\"text-xl font-bold text-white\" x-text=\"(dashboard.severity_counts && dashboard.severity_counts.high) || 0\"></p><p class=\"text-xs text-gray-400\">High</p></div><div class=\"card p-3 text-center\"><i class=\"fas fa-cubes text-green-400 text-lg mb-1\"></i><p class=\"text-xl font-bold text-white\" x-text=\"(dashboard.top_containers && dashboard.top_containers.length) || 0\"></p><p class=\"text-xs text-gray-400\">Monitored Containers</p></div></div><!-- Tabs --><div x-show=\"!loadingDashboard\" x-cloak class=\"space-y-4\"><div class=\"flex gap-1 border-b border-dark-600\"><button @click=\"tab = 'events'\" :class=\"tab === 'events' ? 'border-primary-500 text-white' : 'border-transparent text-gray-400 hover:text-gray-300'\" class=\"px-4 py-2 text-sm font-medium border-b-2 -mb-px transition-colors\"><i class=\"fas fa-bell mr-2\"></i>Events <span class=\"ml-1 px-1.5 py-0.5 text-xs bg-dark-600 rounded\" x-text=\"eventsTotal\"></span></button> <button @click=\"tab = 'rules'; fetchRules()\" :class=\"tab === 'rules' ? 'border-primary-500 text-white' : 'border-transparent text-gray-400 hover:text-gray-300'\" class=\"px-4 py-2 text-sm font-medium border-b-2 -mb-px transition-colors\"><i class=\"fas fa-ruler-combined mr-2\"></i>Rules <span class=\"ml-1 px-1.5 py-0.5 text-xs bg-dark-600 rounded\" x-text=\"rules.length\"></span></button></div><!-- Events Tab --><div x-show=\"tab === 'events'\" x-cloak class=\"space-y-4\"><!-- Event Filters --><div class=\"flex items-center gap-3\"><select x-model=\"eventSeverityFilter\" @change=\"fetchEvents()\" class=\"input text-sm\"><option value=\"\">All Severities</option> <option value=\"critical\">Critical</option> <option value=\"high\">High</option> <option value=\"medium\">Medium</option> <option value=\"low\">Low</option></select> <select x-model=\"eventTypeFilter\" @change=\"fetchEvents()\" class=\"input text-sm\"><option value=\"\">All Event Types</option> <option value=\"process\">Process</option> <option value=\"file\">File</option> <option value=\"network\">Network</option> <option value=\"behavior\">Behavior</option></select> <span class=\"text-sm text-gray-400\" x-text=\"eventsTotal + ' events'\"></span></div><!-- Events Loading --><div x-show=\"loadingEvents\" class=\"card p-8 text-center\"><i class=\"fas fa-spinner fa-spin text-xl text-gray-400 mb-2\"></i><p class=\"text-sm text-gray-400\">Loading events...</p></div><!-- Events Error --><div x-show=\"eventsError && !loadingEvents\" x-cloak class=\"card border-l-4 border-l-red-500 p-4\"><div class=\"flex items-center gap-3\"><i class=\"fas fa-exclamation-circle text-red-400\"></i><p class=\"text-sm text-red-400\" x-text=\"eventsError\"></p><button @click=\"fetchEvents()\" class=\"ml-auto btn-secondary text-sm\">Retry</button></div></div><!-- Events Table --><div x-show=\"!loadingEvents && !eventsError && events.length > 0\" x-cloak class=\"card overflow-hidden\"><table class=\"w-full\"><thead><tr class=\"border-b border-dark-600\"><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Timestamp</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Container</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Event Type</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Severity</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Message</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Actions</th></tr></thead> <tbody class=\"divide-y divide-dark-700\"><template x-for=\"event in events\" :key=\"event.id\"><tr class=\"hover:bg-dark-700/50\"><td class=\"px-4 py-3 text-sm text-gray-400 whitespace-nowrap\" x-text=\"formatTimestamp(event.detected_at)\"></td><td class=\"px-4 py-3\"><div class=\"text-sm text-white\" x-text=\"event.container_name || event.container_id || '-'\"></div><div class=\"text-xs text-gray-500 font-mono\" x-text=\"event.container_id ? event.container_id.substring(0, 12) : ''\"></div></td><td class=\"px-4 py-3\"><span class=\"px-2 py-0.5 text-xs bg-dark-600 text-gray-300 rounded\" x-text=\"event.event_type || '-'\"></span></td><td class=\"px-4 py-3\"><span class=\"px-2 py-0.5 text-xs rounded\" :class=\"severityClass(event.severity)\" x-text=\"event.severity\"></span></td><td class=\"px-4 py-3\"><div class=\"text-sm text-gray-300 max-w-[300px] truncate\" x-text=\"event.description || '-'\"></div></td><td class=\"px-4 py-3\"><button @click=\"acknowledgeEvent(event.id)\" class=\"p-1.5 text-gray-400 hover:text-yellow-400 transition-colors\" title=\"Acknowledge\" :disabled=\"event._acknowledging\"><i class=\"fas fa-eye text-sm\" :class=\"event._acknowledging && 'animate-spin'\"></i></button></td></tr></template></tbody></table></div><!-- Events Empty State --><div x-show=\"!loadingEvents && !eventsError && events.length === 0\" x-cloak class=\"card p-12 text-center\"><i class=\"fas fa-check-circle text-4xl text-green-400 mb-4\"></i><h3 class=\"text-lg font-medium text-white mb-2\">No Security Events</h3><p class=\"text-gray-400\">No runtime security events have been detected</p></div></div><!-- Rules Tab --><div x-show=\"tab === 'rules'\" x-cloak class=\"space-y-4\"><!-- Rules Loading --><div x-show=\"loadingRules\" class=\"card p-8 text-center\"><i class=\"fas fa-spinner fa-spin text-xl text-gray-400 mb-2\"></i><p class=\"text-sm text-gray-400\">Loading rules...</p></div><!-- Rules Error --><div x-show=\"rulesError && !loadingRules\" x-cloak class=\"card border-l-4 border-l-red-500 p-4\"><div class=\"flex items-center gap-3\"><i class=\"fas fa-exclamation-circle text-red-400\"></i><p class=\"text-sm text-red-400\" x-text=\"rulesError\"></p><button @click=\"fetchRules()\" class=\"ml-auto btn-secondary text-sm\">Retry</button></div></div><!-- Rules Table --><div x-show=\"!loadingRules && !rulesError && rules.length > 0\" x-cloak class=\"card overflow-hidden\"><table class=\"w-full\"><thead><tr class=\"border-b border-dark-600\"><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Rule</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Category</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Severity</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Status</th></tr></thead> <tbody class=\"divide-y divide-dark-700\"><template x-for=\"rule in rules\" :key=\"rule.id\"><tr class=\"hover:bg-dark-700/50\"><td class=\"px-4 py-3\"><div class=\"font-medium text-white\" x-text=\"rule.name\"></div><div class=\"text-sm text-gray-400 mt-0.5 max-w-[400px] truncate\" x-text=\"rule.description\"></div></td><td class=\"px-4 py-3\"><span class=\"px-2 py-0.5 text-xs rounded\" :class=\"categoryClass(rule.category)\" x-text=\"rule.category || '-'\"></span></td><td class=\"px-4 py-3\"><span class=\"px-2 py-0.5 text-xs rounded\" :class=\"severityClass(rule.severity)\" x-text=\"rule.severity\"></span></td><td class=\"px-4 py-3\"><template x-if=\"rule.is_enabled\"><span class=\"px-2 py-0.5 text-xs bg-green-500/20 text-green-400 rounded flex items-center gap-1 w-fit\"><span class=\"w-1.5 h-1.5 rounded-full bg-green-400\"></span>Enabled</span></template><template x-if=\"!rule.is_enabled\"><span class=\"px-2 py-0.5 text-xs bg-gray-500/20 text-gray-400 rounded flex items-center gap-1 w-fit\"><span class=\"w-1.5 h-1.5 rounded-full bg-gray-400\"></span>Disabled</span></template></td></tr></template></tbody></table></div><!-- Rules Empty State --><div x-show=\"!loadingRules && !rulesError && rules.length === 0\" x-cloak class=\"card p-12 text-center\"><i class=\"fas fa-ruler-combined text-4xl text-gray-400 mb-4\"></i><h3 class=\"text-lg font-medium text-white mb-2\">No Detection Rules</h3><p class=\"text-gray-400 mb-4\">Seed default rules to start monitoring container runtime behavior</p><button @click=\"seedRules()\" :disabled=\"seedingRules\" class=\"btn-primary\"><i class=\"fas fa-database mr-2\"></i>Seed Default Rules</button></div></div></div></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = layouts.Base(data.PageData).Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

func runtimeSecAlpineInit(csrfToken string) string {
	return `{
		tab: 'events',
		csrfToken: '` + csrfToken + `',

		dashboard: {},
		loadingDashboard: true,

		events: [],
		eventsTotal: 0,
		loadingEvents: false,
		eventsError: null,
		eventSeverityFilter: '',
		eventTypeFilter: '',

		rules: [],
		loadingRules: false,
		rulesError: null,

		seedingRules: false,
		monitoring: false,

		init() {
			this.fetchDashboard();
			this.fetchEvents();
		},

		async fetchDashboard() {
			this.loadingDashboard = true;
			try {
				const resp = await fetch('/api/v1/runtime-security/dashboard');
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'HTTP ' + resp.status); }
				this.dashboard = await resp.json();
			} catch (e) {
				this.dashboard = {};
			} finally {
				this.loadingDashboard = false;
			}
		},

		async fetchEvents() {
			this.loadingEvents = true;
			this.eventsError = null;
			try {
				var params = new URLSearchParams();
				if (this.eventSeverityFilter) params.set('severity', this.eventSeverityFilter);
				if (this.eventTypeFilter) params.set('event_type', this.eventTypeFilter);
				params.set('limit', '100');
				const resp = await fetch('/api/v1/runtime-security/events?' + params.toString());
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'HTTP ' + resp.status); }
				const data = await resp.json();
				this.events = data.events || [];
				this.eventsTotal = data.total || this.events.length;
			} catch (e) {
				this.eventsError = e.message || 'Failed to fetch events';
				this.events = [];
				this.eventsTotal = 0;
			} finally {
				this.loadingEvents = false;
			}
		},

		async fetchRules() {
			if (this.rules.length > 0 && !this.rulesError) return;
			this.loadingRules = true;
			this.rulesError = null;
			try {
				const resp = await fetch('/api/v1/runtime-security/rules');
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'HTTP ' + resp.status); }
				const data = await resp.json();
				this.rules = Array.isArray(data) ? data : [];
			} catch (e) {
				this.rulesError = e.message || 'Failed to fetch rules';
				this.rules = [];
			} finally {
				this.loadingRules = false;
			}
		},

		async acknowledgeEvent(eventId) {
			var event = this.events.find(e => e.id === eventId);
			if (event) event._acknowledging = true;
			try {
				const resp = await fetch('/api/v1/runtime-security/events/' + encodeURIComponent(eventId) + '/acknowledge', {
					method: 'POST',
					headers: { 'X-CSRF-Token': this.csrfToken }
				});
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'HTTP ' + resp.status); }
				if (window.usulnet) { window.usulnet.toast('Event acknowledged', 'success'); }
				await this.fetchEvents();
				await this.fetchDashboard();
			} catch (e) {
				var msg = e.message || 'Failed to acknowledge event';
				if (window.usulnet) { window.usulnet.toast(msg, 'error'); } else { console.error(msg); }
			} finally {
				if (event) event._acknowledging = false;
			}
		},

		async seedRules() {
			this.seedingRules = true;
			try {
				const resp = await fetch('/api/v1/runtime-security/rules/seed', {
					method: 'POST',
					headers: { 'X-CSRF-Token': this.csrfToken }
				});
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'HTTP ' + resp.status); }
				if (window.usulnet) { window.usulnet.toast('Default rules seeded', 'success'); }
				this.rules = [];
				await this.fetchRules();
			} catch (e) {
				var msg = e.message || 'Failed to seed rules';
				if (window.usulnet) { window.usulnet.toast(msg, 'error'); } else { console.error(msg); }
			} finally {
				this.seedingRules = false;
			}
		},

		async monitorAll() {
			this.monitoring = true;
			try {
				const resp = await fetch('/api/v1/runtime-security/monitor', {
					method: 'POST',
					headers: { 'X-CSRF-Token': this.csrfToken }
				});
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'HTTP ' + resp.status); }
				if (window.usulnet) { window.usulnet.toast('Monitoring triggered for all containers', 'success'); }
				setTimeout(() => { this.fetchEvents(); this.fetchDashboard(); }, 2000);
			} catch (e) {
				var msg = e.message || 'Failed to start monitoring';
				if (window.usulnet) { window.usulnet.toast(msg, 'error'); } else { console.error(msg); }
			} finally {
				this.monitoring = false;
			}
		},

		formatTimestamp(ts) {
			if (!ts) return '-';
			try {
				var d = new Date(ts);
				return d.toLocaleString();
			} catch (e) {
				return ts;
			}
		},

		severityClass(severity) {
			switch (severity) {
				case 'critical': return 'bg-red-500/20 text-red-400';
				case 'high': return 'bg-orange-500/20 text-orange-400';
				case 'medium': return 'bg-yellow-500/20 text-yellow-400';
				case 'low': return 'bg-blue-500/20 text-blue-400';
				default: return 'bg-gray-500/20 text-gray-400';
			}
		},

		categoryClass(category) {
			switch (category) {
				case 'intrusion': return 'bg-red-500/20 text-red-400';
				case 'malware': return 'bg-red-500/20 text-red-400';
				case 'privilege_escalation': return 'bg-orange-500/20 text-orange-400';
				case 'container_escape': return 'bg-orange-500/20 text-orange-400';
				case 'file_access': return 'bg-cyan-500/20 text-cyan-400';
				case 'file_integrity': return 'bg-cyan-500/20 text-cyan-400';
				case 'network': return 'bg-blue-500/20 text-blue-400';
				case 'reconnaissance': return 'bg-blue-500/20 text-blue-400';
				case 'process_execution': return 'bg-purple-500/20 text-purple-400';
				case 'data_exfiltration': return 'bg-yellow-500/20 text-yellow-400';
				default: return 'bg-gray-500/20 text-gray-400';
			}
		}
	}`
}

var _ = templruntime.GeneratedTemplate
