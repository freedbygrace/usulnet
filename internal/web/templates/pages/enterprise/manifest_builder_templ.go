// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
// SPDX-License-Identifier: AGPL-3.0-or-later

// Copyright (c) 2024-2026 usulnet contributors

// https://github.com/fr4nsys/usulnet

package enterprise

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import (
	"github.com/fr4nsys/usulnet/internal/web/templates/layouts"
)

type ManifestBuilderData struct {
	PageData layouts.PageData
}

func ManifestBuilder(data ManifestBuilderData) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div x-data=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var3 string
			templ_7745c5c3_Var3, templ_7745c5c3_Err = templ.JoinStringErrs(manifestBuilderApp(data.PageData.CSRFToken))
			if templ_7745c5c3_Err != nil {
				return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/web/templates/pages/enterprise/manifest_builder.templ`, Line: 18, Col: 55}
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var3))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "\" x-init=\"init()\" class=\"space-y-6\" x-cloak><!-- ============================================================ --><!-- Sessions List View                                           --><!-- ============================================================ --><div x-show=\"!activeSession\"><!-- Header --><div class=\"flex items-center justify-between mb-6\"><div><h1 class=\"text-2xl font-display font-bold text-white\">Manifest Builder</h1><p class=\"text-gray-400 mt-1\">Visually compose Docker Compose files from reusable service blocks</p></div><button @click=\"showCreateModal = true\" class=\"btn-primary\"><i class=\"fas fa-plus mr-2\"></i>New Session</button></div><!-- Stats --><div class=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6\"><div class=\"bg-dark-800 rounded-xl border border-dark-600 p-5\"><div class=\"flex items-center gap-3\"><div class=\"w-10 h-10 rounded-lg bg-primary-500/10 flex items-center justify-center\"><i class=\"fas fa-drafting-compass text-primary-400\"></i></div><div><p class=\"text-2xl font-bold text-white\" x-text=\"sessions.length\"></p><p class=\"text-xs text-gray-500\">Sessions</p></div></div></div><div class=\"bg-dark-800 rounded-xl border border-dark-600 p-5\"><div class=\"flex items-center gap-3\"><div class=\"w-10 h-10 rounded-lg bg-green-500/10 flex items-center justify-center\"><i class=\"fas fa-puzzle-piece text-green-400\"></i></div><div><p class=\"text-2xl font-bold text-white\" x-text=\"components.length\"></p><p class=\"text-xs text-gray-500\">Components</p></div></div></div><div class=\"bg-dark-800 rounded-xl border border-dark-600 p-5\"><div class=\"flex items-center gap-3\"><div class=\"w-10 h-10 rounded-lg bg-blue-500/10 flex items-center justify-center\"><i class=\"fas fa-file-code text-blue-400\"></i></div><div><p class=\"text-2xl font-bold text-white\" x-text=\"templates.length\"></p><p class=\"text-xs text-gray-500\">Templates</p></div></div></div></div><!-- Sessions List --><div class=\"bg-dark-800 rounded-xl border border-dark-600 overflow-hidden\"><template x-if=\"loadingSessions\"><div class=\"p-8 text-center text-gray-400\"><i class=\"fas fa-spinner fa-spin text-2xl mb-3\"></i><p>Loading sessions...</p></div></template><template x-if=\"!loadingSessions && sessions.length === 0\"><div class=\"p-8 text-center text-gray-400\"><i class=\"fas fa-drafting-compass text-3xl mb-3\"></i><p>No builder sessions yet</p><p class=\"text-sm mt-1\">Create a session to start composing Docker Compose files visually.</p></div></template><template x-if=\"!loadingSessions && sessions.length > 0\"><div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 p-4\"><template x-for=\"session in sessions\" :key=\"session.id\"><div class=\"bg-dark-700 rounded-lg border border-dark-600 p-4 hover:border-primary-500/50 transition-colors\"><div class=\"flex items-start justify-between mb-3\"><div class=\"flex-1 min-w-0\"><h3 class=\"text-white font-medium truncate\" x-text=\"session.name\"></h3><p class=\"text-xs text-gray-500 mt-1\" x-text=\"'Created ' + new Date(session.created_at).toLocaleDateString()\"></p></div><span class=\"px-2 py-0.5 text-xs rounded ml-2 flex-shrink-0\" :class=\"session.is_saved ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'\" x-text=\"session.is_saved ? 'Saved' : 'Draft'\"></span></div><div class=\"flex items-center gap-3 text-xs text-gray-400 mb-4\"><span><i class=\"fas fa-cubes mr-1\"></i> <span x-text=\"serviceCount(session) + ' services'\"></span></span> <span><i class=\"fas fa-file-code mr-1\"></i> <span x-text=\"session.format || 'compose'\"></span></span></div><div class=\"flex items-center gap-2\"><button @click=\"openSession(session)\" class=\"flex-1 btn-primary text-sm py-1.5\"><i class=\"fas fa-edit mr-1\"></i>Open</button> <button @click=\"generateFromList(session)\" class=\"p-1.5 text-gray-400 hover:text-blue-400 transition-colors\" title=\"Generate YAML\"><i class=\"fas fa-file-export text-sm\"></i></button> <button @click=\"deleteSession(session)\" class=\"p-1.5 text-gray-400 hover:text-red-400 transition-colors\" title=\"Delete\"><i class=\"fas fa-trash text-sm\"></i></button></div></div></template></div></template></div></div><!-- ============================================================ --><!-- Session Editor View                                          --><!-- ============================================================ --><div x-show=\"activeSession\"><!-- Editor Header --><div class=\"flex items-center justify-between mb-4\"><div class=\"flex items-center gap-3\"><button @click=\"closeSession()\" class=\"p-2 text-gray-400 hover:text-white transition-colors\" title=\"Back to sessions\"><i class=\"fas fa-arrow-left\"></i></button><div><h1 class=\"text-xl font-display font-bold text-white\" x-text=\"activeSession?.name || 'Untitled'\"></h1><p class=\"text-xs text-gray-500\"><span x-text=\"activeSession?.format || 'compose'\"></span> <span class=\"mx-1\">|</span> <span x-text=\"editorServices.length + ' services'\"></span></p></div></div><div class=\"flex items-center gap-2\"><button @click=\"autoSave()\" class=\"btn-secondary text-sm\" :disabled=\"saving\"><i class=\"fas fa-save mr-1\" x-show=\"!saving\"></i> <i class=\"fas fa-spinner fa-spin mr-1\" x-show=\"saving\"></i> Save</button></div></div><!-- Three-panel Layout --><div class=\"grid grid-cols-12 gap-4\" style=\"min-height: 70vh;\"><!-- Left Panel: Available Components/Templates --><div class=\"col-span-3 bg-dark-800 rounded-xl border border-dark-600 overflow-hidden flex flex-col\"><div class=\"p-3 border-b border-dark-600\"><h2 class=\"text-sm font-semibold text-white mb-2\">Service Library</h2><input type=\"text\" x-model=\"componentSearch\" class=\"input w-full text-sm\" placeholder=\"Search components...\"><div class=\"flex gap-1 mt-2 flex-wrap\"><button @click=\"componentFilter = ''\" class=\"px-2 py-0.5 text-xs rounded transition-colors\" :class=\"componentFilter === '' ? 'bg-primary-500/20 text-primary-400' : 'bg-dark-700 text-gray-400 hover:text-white'\">All</button><template x-for=\"cat in categories\" :key=\"cat\"><button @click=\"componentFilter = cat\" class=\"px-2 py-0.5 text-xs rounded transition-colors\" :class=\"componentFilter === cat ? 'bg-primary-500/20 text-primary-400' : 'bg-dark-700 text-gray-400 hover:text-white'\" x-text=\"cat\"></button></template></div></div><div class=\"flex-1 overflow-y-auto p-2 space-y-1\"><template x-if=\"loadingComponents\"><div class=\"p-4 text-center text-gray-400 text-sm\"><i class=\"fas fa-spinner fa-spin mr-1\"></i>Loading...</div></template><template x-for=\"comp in filteredComponents()\" :key=\"comp.id\"><button @click=\"showAddServiceModal(comp)\" class=\"w-full text-left p-2.5 rounded-lg bg-dark-700 hover:bg-dark-600 border border-dark-600 hover:border-primary-500/30 transition-colors group\"><div class=\"flex items-center gap-2\"><div class=\"w-7 h-7 rounded bg-dark-600 flex items-center justify-center flex-shrink-0\"><i :class=\"comp.icon || 'fas fa-cube'\" class=\"text-xs text-primary-400\"></i></div><div class=\"min-w-0 flex-1\"><p class=\"text-sm text-white font-medium truncate\" x-text=\"comp.name\"></p><p class=\"text-xs text-gray-500 truncate\" x-text=\"comp.description\"></p></div><i class=\"fas fa-plus text-xs text-gray-600 group-hover:text-primary-400 transition-colors flex-shrink-0\"></i></div></button></template><!-- Templates section --><template x-if=\"!loadingComponents && filteredTemplates().length > 0\"><div class=\"pt-2 border-t border-dark-600 mt-2\"><p class=\"text-xs text-gray-500 font-medium px-1 mb-1 uppercase tracking-wider\">Templates</p><template x-for=\"tmpl in filteredTemplates()\" :key=\"tmpl.id\"><button @click=\"showAddFromTemplate(tmpl)\" class=\"w-full text-left p-2.5 rounded-lg bg-dark-700 hover:bg-dark-600 border border-dark-600 hover:border-blue-500/30 transition-colors group\"><div class=\"flex items-center gap-2\"><div class=\"w-7 h-7 rounded bg-blue-500/10 flex items-center justify-center flex-shrink-0\"><i :class=\"tmpl.icon || 'fas fa-file-alt'\" class=\"text-xs text-blue-400\"></i></div><div class=\"min-w-0 flex-1\"><p class=\"text-sm text-white font-medium truncate\" x-text=\"tmpl.name\"></p><p class=\"text-xs text-gray-500 truncate\" x-text=\"tmpl.category\"></p></div><i class=\"fas fa-plus text-xs text-gray-600 group-hover:text-blue-400 transition-colors flex-shrink-0\"></i></div></button></template></div></template></div></div><!-- Center Panel: Service Cards Grid --><div class=\"col-span-5 bg-dark-800 rounded-xl border border-dark-600 overflow-hidden flex flex-col\"><div class=\"p-3 border-b border-dark-600 flex items-center justify-between\"><h2 class=\"text-sm font-semibold text-white\">Services</h2><span class=\"text-xs text-gray-500\" x-text=\"editorServices.length + ' service(s)'\"></span></div><div class=\"flex-1 overflow-y-auto p-3\"><template x-if=\"editorServices.length === 0\"><div class=\"flex flex-col items-center justify-center h-full text-gray-400\"><i class=\"fas fa-cubes text-3xl mb-3\"></i><p class=\"text-sm\">No services added yet</p><p class=\"text-xs mt-1\">Click a component from the left panel to add it</p></div></template><div class=\"grid grid-cols-1 gap-3\"><template x-for=\"(svc, idx) in editorServices\" :key=\"idx\"><div class=\"bg-dark-700 rounded-lg border border-dark-600 p-4 hover:border-dark-500 transition-colors\"><div class=\"flex items-start justify-between mb-3\"><div class=\"flex items-center gap-2 min-w-0\"><div class=\"w-8 h-8 rounded bg-primary-500/10 flex items-center justify-center flex-shrink-0\"><i class=\"fas fa-cube text-primary-400 text-sm\"></i></div><div class=\"min-w-0\"><p class=\"text-white font-medium text-sm truncate\" x-text=\"svc.name\"></p><p class=\"text-xs text-gray-500 font-mono truncate\" x-text=\"svc.image + (svc.tag ? ':' + svc.tag : '')\"></p></div></div><div class=\"flex items-center gap-1 flex-shrink-0\"><button @click=\"editService(idx)\" class=\"p-1 text-gray-400 hover:text-primary-400 transition-colors\" title=\"Edit\"><i class=\"fas fa-pen text-xs\"></i></button> <button @click=\"removeService(idx)\" class=\"p-1 text-gray-400 hover:text-red-400 transition-colors\" title=\"Remove\"><i class=\"fas fa-times text-xs\"></i></button></div></div><!-- Service details summary --><div class=\"space-y-1.5 text-xs\"><template x-if=\"svc.ports && svc.ports.length > 0\"><div class=\"flex items-center gap-1.5 text-gray-400\"><i class=\"fas fa-network-wired w-3.5 text-center\"></i> <span x-text=\"svc.ports.map(function(p) { return p.host + ':' + p.container; }).join(', ')\"></span></div></template><template x-if=\"svc.volumes && svc.volumes.length > 0\"><div class=\"flex items-center gap-1.5 text-gray-400\"><i class=\"fas fa-hdd w-3.5 text-center\"></i> <span x-text=\"svc.volumes.length + ' volume(s)'\"></span></div></template><template x-if=\"svc.environment && Object.keys(svc.environment).length > 0\"><div class=\"flex items-center gap-1.5 text-gray-400\"><i class=\"fas fa-key w-3.5 text-center\"></i> <span x-text=\"Object.keys(svc.environment).length + ' env var(s)'\"></span></div></template><template x-if=\"svc.depends_on && svc.depends_on.length > 0\"><div class=\"flex items-center gap-1.5 text-gray-400\"><i class=\"fas fa-link w-3.5 text-center\"></i> <span x-text=\"'depends on: ' + svc.depends_on.join(', ')\"></span></div></template><template x-if=\"svc.restart\"><div class=\"flex items-center gap-1.5 text-gray-400\"><i class=\"fas fa-redo w-3.5 text-center\"></i> <span x-text=\"'restart: ' + svc.restart\"></span></div></template></div></div></template></div></div></div><!-- Right Panel: YAML Preview & Actions --><div class=\"col-span-4 bg-dark-800 rounded-xl border border-dark-600 overflow-hidden flex flex-col\"><div class=\"p-3 border-b border-dark-600 flex items-center justify-between\"><h2 class=\"text-sm font-semibold text-white\">Generated YAML</h2><div class=\"flex items-center gap-1\"><button @click=\"copyYaml()\" class=\"p-1.5 text-gray-400 hover:text-white transition-colors\" title=\"Copy to clipboard\" x-show=\"generatedYaml\"><i class=\"fas fa-copy text-xs\"></i></button></div></div><div class=\"flex-1 overflow-y-auto p-3\"><template x-if=\"!generatedYaml\"><div class=\"flex flex-col items-center justify-center h-full text-gray-400\"><i class=\"fas fa-file-code text-3xl mb-3\"></i><p class=\"text-sm\">No YAML generated yet</p><p class=\"text-xs mt-1\">Add services and click Generate</p></div></template><template x-if=\"generatedYaml\"><textarea x-model=\"generatedYaml\" class=\"w-full h-full bg-dark-900 text-gray-300 font-mono text-xs border border-dark-600 rounded-lg p-3 resize-none focus:outline-none focus:border-primary-500/50\" spellcheck=\"false\"></textarea></template></div><!-- Validation Errors --><template x-if=\"validationErrors.length > 0\"><div class=\"px-3 py-2 border-t border-dark-600 max-h-32 overflow-y-auto\"><template x-for=\"(err, i) in validationErrors\" :key=\"i\"><div class=\"flex items-start gap-2 text-xs py-1\"><i class=\"fas fa-exclamation-circle text-red-400 mt-0.5 flex-shrink-0\"></i> <span class=\"text-red-300\" x-text=\"typeof err === 'string' ? err : (err.message ? (err.field ? err.field + ': ' + err.message : err.message) : JSON.stringify(err))\"></span></div></template></div></template><!-- Action Buttons --><div class=\"p-3 border-t border-dark-600 space-y-2\"><button @click=\"generateYaml()\" class=\"w-full btn-primary text-sm\" :disabled=\"generating || editorServices.length === 0\"><i class=\"fas fa-cogs mr-1.5\" x-show=\"!generating\"></i> <i class=\"fas fa-spinner fa-spin mr-1.5\" x-show=\"generating\"></i> <span x-text=\"generating ? 'Generating...' : 'Generate'\"></span></button><div class=\"grid grid-cols-2 gap-2\"><button @click=\"validateYaml()\" class=\"btn-secondary text-sm\" :disabled=\"!generatedYaml || validating\"><i class=\"fas fa-check-circle mr-1\" x-show=\"!validating\"></i> <i class=\"fas fa-spinner fa-spin mr-1\" x-show=\"validating\"></i> Validate</button> <button @click=\"saveAsStack()\" class=\"btn-secondary text-sm\" :disabled=\"!generatedYaml || savingStack\"><i class=\"fas fa-layer-group mr-1\" x-show=\"!savingStack\"></i> <i class=\"fas fa-spinner fa-spin mr-1\" x-show=\"savingStack\"></i> Save as Stack</button></div></div></div></div></div><!-- ============================================================ --><!-- Create Session Modal                                         --><!-- ============================================================ --><template x-if=\"showCreateModal\"><div class=\"fixed inset-0 z-50 flex items-center justify-center p-4\" @keydown.escape.window=\"showCreateModal = false\"><div class=\"fixed inset-0 bg-black/60\" @click=\"showCreateModal = false\"></div><div class=\"relative bg-dark-800 rounded-xl border border-dark-600 w-full max-w-md shadow-2xl\"><div class=\"flex items-center justify-between p-5 border-b border-dark-600\"><h3 class=\"text-lg font-semibold text-white\">New Builder Session</h3><button @click=\"showCreateModal = false\" class=\"text-gray-400 hover:text-white\"><i class=\"fas fa-times\"></i></button></div><div class=\"p-5 space-y-4\"><div><label class=\"block text-sm font-medium text-gray-300 mb-2\">Session Name</label> <input type=\"text\" x-model=\"newSession.name\" class=\"input w-full\" placeholder=\"my-compose-project\" @keydown.enter=\"createSession()\"></div><div><label class=\"block text-sm font-medium text-gray-300 mb-2\">Format</label> <select x-model=\"newSession.format\" class=\"input w-full\"><option value=\"compose\">Docker Compose</option> <option value=\"kubernetes\">Kubernetes</option> <option value=\"swarm\">Docker Swarm</option></select></div></div><div class=\"flex justify-end gap-3 p-5 border-t border-dark-600\"><button @click=\"showCreateModal = false\" class=\"btn-secondary\">Cancel</button> <button @click=\"createSession()\" class=\"btn-primary\" :disabled=\"!newSession.name || creatingSession\"><i class=\"fas fa-plus mr-2\" x-show=\"!creatingSession\"></i> <i class=\"fas fa-spinner fa-spin mr-2\" x-show=\"creatingSession\"></i> <span x-text=\"creatingSession ? 'Creating...' : 'Create'\"></span></button></div></div></div></template><!-- ============================================================ --><!-- Add/Edit Service Modal                                       --><!-- ============================================================ --><template x-if=\"showServiceModal\"><div class=\"fixed inset-0 z-50 flex items-center justify-center p-4\" @keydown.escape.window=\"showServiceModal = false\"><div class=\"fixed inset-0 bg-black/60\" @click=\"showServiceModal = false\"></div><div class=\"relative bg-dark-800 rounded-xl border border-dark-600 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl\"><div class=\"flex items-center justify-between p-5 border-b border-dark-600\"><h3 class=\"text-lg font-semibold text-white\" x-text=\"editingServiceIdx >= 0 ? 'Edit Service' : 'Add Service'\"></h3><button @click=\"showServiceModal = false\" class=\"text-gray-400 hover:text-white\"><i class=\"fas fa-times\"></i></button></div><div class=\"p-5 space-y-4\"><!-- Name --><div><label class=\"block text-sm font-medium text-gray-300 mb-2\">Service Name</label> <input type=\"text\" x-model=\"serviceForm.name\" class=\"input w-full\" placeholder=\"my-service\"></div><!-- Image --><div class=\"grid grid-cols-3 gap-3\"><div class=\"col-span-2\"><label class=\"block text-sm font-medium text-gray-300 mb-2\">Image</label> <input type=\"text\" x-model=\"serviceForm.image\" class=\"input w-full font-mono\" placeholder=\"nginx\"></div><div><label class=\"block text-sm font-medium text-gray-300 mb-2\">Tag</label> <input type=\"text\" x-model=\"serviceForm.tag\" class=\"input w-full font-mono\" placeholder=\"latest\"></div></div><!-- Restart Policy --><div><label class=\"block text-sm font-medium text-gray-300 mb-2\">Restart Policy</label> <select x-model=\"serviceForm.restart\" class=\"input w-full\"><option value=\"\">none</option> <option value=\"always\">always</option> <option value=\"unless-stopped\">unless-stopped</option> <option value=\"on-failure\">on-failure</option></select></div><!-- Command --><div><label class=\"block text-sm font-medium text-gray-300 mb-2\">Command (optional)</label> <input type=\"text\" x-model=\"serviceForm.command\" class=\"input w-full font-mono\" placeholder=\"e.g. --config /etc/app.conf\"></div><!-- Depends On --><div><label class=\"block text-sm font-medium text-gray-300 mb-2\">Depends On (comma-separated)</label> <input type=\"text\" x-model=\"serviceForm.depends_on_str\" class=\"input w-full font-mono\" placeholder=\"db, redis\"></div><!-- Ports --><div><label class=\"block text-sm font-medium text-gray-300 mb-2\">Port Mappings <button @click=\"addPort()\" class=\"ml-2 text-xs text-primary-400 hover:text-primary-300\">+ Add</button></label><template x-for=\"(port, pi) in serviceForm.ports\" :key=\"pi\"><div class=\"flex items-center gap-2 mb-2\"><input type=\"number\" x-model.number=\"port.host\" class=\"input w-24 text-sm font-mono\" placeholder=\"Host\"> <span class=\"text-gray-500\">:</span> <input type=\"number\" x-model.number=\"port.container\" class=\"input w-24 text-sm font-mono\" placeholder=\"Container\"> <select x-model=\"port.protocol\" class=\"input w-20 text-sm\"><option value=\"tcp\">TCP</option> <option value=\"udp\">UDP</option></select> <button @click=\"serviceForm.ports.splice(pi, 1)\" class=\"p-1 text-gray-400 hover:text-red-400\"><i class=\"fas fa-times text-xs\"></i></button></div></template></div><!-- Volumes --><div><label class=\"block text-sm font-medium text-gray-300 mb-2\">Volume Mounts <button @click=\"addVolume()\" class=\"ml-2 text-xs text-primary-400 hover:text-primary-300\">+ Add</button></label><template x-for=\"(vol, vi) in serviceForm.volumes\" :key=\"vi\"><div class=\"flex items-center gap-2 mb-2\"><input type=\"text\" x-model=\"vol.source\" class=\"input flex-1 text-sm font-mono\" placeholder=\"Source\"> <span class=\"text-gray-500\">:</span> <input type=\"text\" x-model=\"vol.target\" class=\"input flex-1 text-sm font-mono\" placeholder=\"Target\"> <label class=\"flex items-center gap-1 flex-shrink-0\"><input type=\"checkbox\" x-model=\"vol.read_only\" class=\"rounded border-dark-600 bg-dark-700 text-primary-500\"> <span class=\"text-xs text-gray-400\">RO</span></label> <button @click=\"serviceForm.volumes.splice(vi, 1)\" class=\"p-1 text-gray-400 hover:text-red-400\"><i class=\"fas fa-times text-xs\"></i></button></div></template></div><!-- Environment Variables --><div><label class=\"block text-sm font-medium text-gray-300 mb-2\">Environment Variables <button @click=\"addEnvVar()\" class=\"ml-2 text-xs text-primary-400 hover:text-primary-300\">+ Add</button></label><template x-for=\"(ev, ei) in serviceForm.envList\" :key=\"ei\"><div class=\"flex items-center gap-2 mb-2\"><input type=\"text\" x-model=\"ev.key\" class=\"input flex-1 text-sm font-mono\" placeholder=\"KEY\"> <span class=\"text-gray-500\">=</span> <input type=\"text\" x-model=\"ev.value\" class=\"input flex-1 text-sm font-mono\" placeholder=\"value\"> <button @click=\"serviceForm.envList.splice(ei, 1)\" class=\"p-1 text-gray-400 hover:text-red-400\"><i class=\"fas fa-times text-xs\"></i></button></div></template></div></div><div class=\"flex justify-end gap-3 p-5 border-t border-dark-600\"><button @click=\"showServiceModal = false\" class=\"btn-secondary\">Cancel</button> <button @click=\"submitService()\" class=\"btn-primary\" :disabled=\"!serviceForm.name || !serviceForm.image\"><i class=\"fas fa-check mr-2\"></i> <span x-text=\"editingServiceIdx >= 0 ? 'Update' : 'Add Service'\"></span></button></div></div></div></template></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = layouts.Base(data.PageData).Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

func manifestBuilderApp(csrfToken string) string {
	return `{
		csrfToken: '` + csrfToken + `',

		// View state
		activeSession: null,
		loadingSessions: true,
		loadingComponents: true,
		creatingSession: false,
		saving: false,
		generating: false,
		validating: false,
		savingStack: false,
		showCreateModal: false,
		showServiceModal: false,

		// Data
		sessions: [],
		components: [],
		templates: [],
		categories: [],
		editorServices: [],
		generatedYaml: '',
		validationErrors: [],

		// Filters
		componentSearch: '',
		componentFilter: '',

		// Forms
		newSession: { name: '', format: 'compose' },
		serviceForm: {
			name: '',
			image: '',
			tag: '',
			restart: 'unless-stopped',
			command: '',
			depends_on_str: '',
			ports: [],
			volumes: [],
			envList: []
		},
		editingServiceIdx: -1,

		async init() {
			await Promise.all([
				this.loadSessions(),
				this.loadComponents(),
				this.loadTemplates(),
				this.loadCategories()
			]);
		},

		headers() {
			var h = { 'Content-Type': 'application/json' };
			if (this.csrfToken) h['X-CSRF-Token'] = this.csrfToken;
			return h;
		},

		// ================================================================
		// Sessions
		// ================================================================

		async loadSessions() {
			this.loadingSessions = true;
			try {
				var resp = await fetch('/api/v1/manifests/sessions');
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to load sessions'); }
				var body = await resp.json();
				this.sessions = Array.isArray(body) ? body : (body.data || []);
			} catch (e) {
				if (typeof usulnet !== 'undefined') usulnet.toast(e.message, 'error');
				this.sessions = [];
			} finally {
				this.loadingSessions = false;
			}
		},

		async createSession() {
			if (!this.newSession.name) return;
			this.creatingSession = true;
			try {
				var resp = await fetch('/api/v1/manifests/sessions', {
					method: 'POST',
					headers: this.headers(),
					body: JSON.stringify(this.newSession)
				});
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to create session'); }
				var session = await resp.json();
				if (typeof usulnet !== 'undefined') usulnet.toast('Session created', 'success');
				this.showCreateModal = false;
				this.newSession = { name: '', format: 'compose' };
				await this.loadSessions();
				this.openSession(session);
			} catch (e) {
				if (typeof usulnet !== 'undefined') usulnet.toast(e.message, 'error');
			} finally {
				this.creatingSession = false;
			}
		},

		async openSession(session) {
			try {
				var resp = await fetch('/api/v1/manifests/sessions/' + session.id);
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to load session'); }
				this.activeSession = await resp.json();
				this.editorServices = this.parseServices(this.activeSession.services);
				this.generatedYaml = this.activeSession.generated_manifest || '';
				this.validationErrors = [];
			} catch (e) {
				if (typeof usulnet !== 'undefined') usulnet.toast(e.message, 'error');
			}
		},

		closeSession() {
			this.activeSession = null;
			this.editorServices = [];
			this.generatedYaml = '';
			this.validationErrors = [];
			this.loadSessions();
		},

		async deleteSession(session) {
			if (!confirm('Delete session "' + session.name + '"? This cannot be undone.')) return;
			try {
				var resp = await fetch('/api/v1/manifests/sessions/' + session.id, {
					method: 'DELETE',
					headers: this.headers()
				});
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to delete session'); }
				if (typeof usulnet !== 'undefined') usulnet.toast('Session deleted', 'success');
				await this.loadSessions();
			} catch (e) {
				if (typeof usulnet !== 'undefined') usulnet.toast(e.message, 'error');
			}
		},

		async autoSave() {
			if (!this.activeSession) return;
			this.saving = true;
			try {
				var resp = await fetch('/api/v1/manifests/sessions/' + this.activeSession.id, {
					method: 'PUT',
					headers: this.headers(),
					body: JSON.stringify({
						services: this.editorServices,
						canvas_state: this.activeSession.canvas_state || {},
						networks: this.activeSession.networks || {},
						volumes: this.activeSession.volumes || {}
					})
				});
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to save session'); }
				if (typeof usulnet !== 'undefined') usulnet.toast('Session saved', 'success');
			} catch (e) {
				if (typeof usulnet !== 'undefined') usulnet.toast(e.message, 'error');
			} finally {
				this.saving = false;
			}
		},

		// ================================================================
		// Components & Templates
		// ================================================================

		async loadComponents() {
			this.loadingComponents = true;
			try {
				var resp = await fetch('/api/v1/manifests/components');
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to load components'); }
				var body = await resp.json();
				this.components = Array.isArray(body) ? body : (body.data || []);
			} catch (e) {
				this.components = [];
			} finally {
				this.loadingComponents = false;
			}
		},

		async loadTemplates() {
			try {
				var resp = await fetch('/api/v1/manifests/templates');
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to load templates'); }
				var body = await resp.json();
				this.templates = Array.isArray(body) ? body : (body.data || []);
			} catch (e) {
				this.templates = [];
			}
		},

		async loadCategories() {
			try {
				var resp = await fetch('/api/v1/manifests/templates/categories');
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to load categories'); }
				var body = await resp.json();
				this.categories = Array.isArray(body) ? body : (body.data || []);
			} catch (e) {
				this.categories = [];
			}
		},

		filteredComponents() {
			var self = this;
			return this.components.filter(function(c) {
				if (self.componentFilter && c.category !== self.componentFilter) return false;
				if (self.componentSearch) {
					var q = self.componentSearch.toLowerCase();
					return (c.name || '').toLowerCase().indexOf(q) >= 0 ||
						(c.description || '').toLowerCase().indexOf(q) >= 0;
				}
				return true;
			});
		},

		filteredTemplates() {
			var self = this;
			return this.templates.filter(function(t) {
				if (self.componentFilter && t.category !== self.componentFilter) return false;
				if (self.componentSearch) {
					var q = self.componentSearch.toLowerCase();
					return (t.name || '').toLowerCase().indexOf(q) >= 0 ||
						(t.category || '').toLowerCase().indexOf(q) >= 0;
				}
				return true;
			});
		},

		// ================================================================
		// Service Management
		// ================================================================

		showAddServiceModal(comp) {
			var cfg = {};
			try {
				cfg = typeof comp.default_config === 'string' ? JSON.parse(comp.default_config) : (comp.default_config || {});
			} catch (e) { cfg = {}; }
			var ports = [];
			try {
				var rawPorts = typeof comp.ports === 'string' ? JSON.parse(comp.ports) : (comp.ports || []);
				if (Array.isArray(rawPorts)) ports = rawPorts;
			} catch (e) { ports = []; }
			var volumes = [];
			try {
				var rawVols = typeof comp.volumes === 'string' ? JSON.parse(comp.volumes) : (comp.volumes || []);
				if (Array.isArray(rawVols)) volumes = rawVols;
			} catch (e) { volumes = []; }
			var env = {};
			try {
				env = typeof comp.environment === 'string' ? JSON.parse(comp.environment) : (comp.environment || {});
			} catch (e) { env = {}; }
			var envList = [];
			var envKeys = Object.keys(env);
			for (var i = 0; i < envKeys.length; i++) {
				envList.push({ key: envKeys[i], value: env[envKeys[i]] });
			}
			this.serviceForm = {
				name: cfg.name || comp.name.toLowerCase().replace(/\s+/g, '-'),
				image: cfg.image || comp.name.toLowerCase().replace(/\s+/g, ''),
				tag: cfg.tag || 'latest',
				restart: cfg.restart || 'unless-stopped',
				command: cfg.command || '',
				depends_on_str: '',
				ports: ports,
				volumes: volumes,
				envList: envList
			};
			this.editingServiceIdx = -1;
			this.showServiceModal = true;
		},

		showAddFromTemplate(tmpl) {
			this.serviceForm = {
				name: tmpl.name.toLowerCase().replace(/\s+/g, '-'),
				image: '',
				tag: 'latest',
				restart: 'unless-stopped',
				command: '',
				depends_on_str: '',
				ports: [],
				volumes: [],
				envList: []
			};
			this.editingServiceIdx = -1;
			this.showServiceModal = true;
		},

		editService(idx) {
			var svc = this.editorServices[idx];
			var envList = [];
			if (svc.environment) {
				var keys = Object.keys(svc.environment);
				for (var i = 0; i < keys.length; i++) {
					envList.push({ key: keys[i], value: svc.environment[keys[i]] });
				}
			}
			this.serviceForm = {
				name: svc.name,
				image: svc.image,
				tag: svc.tag || '',
				restart: svc.restart || '',
				command: svc.command || '',
				depends_on_str: (svc.depends_on || []).join(', '),
				ports: JSON.parse(JSON.stringify(svc.ports || [])),
				volumes: JSON.parse(JSON.stringify(svc.volumes || [])),
				envList: envList
			};
			this.editingServiceIdx = idx;
			this.showServiceModal = true;
		},

		submitService() {
			if (!this.serviceForm.name || !this.serviceForm.image) return;
			var env = {};
			for (var i = 0; i < this.serviceForm.envList.length; i++) {
				var item = this.serviceForm.envList[i];
				if (item.key) env[item.key] = item.value;
			}
			var deps = [];
			if (this.serviceForm.depends_on_str) {
				deps = this.serviceForm.depends_on_str.split(',').map(function(s) { return s.trim(); }).filter(Boolean);
			}
			var svc = {
				name: this.serviceForm.name,
				image: this.serviceForm.image,
				tag: this.serviceForm.tag,
				restart: this.serviceForm.restart,
				command: this.serviceForm.command,
				depends_on: deps,
				ports: this.serviceForm.ports,
				volumes: this.serviceForm.volumes,
				environment: env,
				networks: [],
				labels: {},
				position_x: 0,
				position_y: 0
			};
			if (this.editingServiceIdx >= 0) {
				this.editorServices[this.editingServiceIdx] = svc;
			} else {
				this.editorServices.push(svc);
			}
			this.showServiceModal = false;
			this.editingServiceIdx = -1;
		},

		removeService(idx) {
			var name = this.editorServices[idx].name;
			if (!confirm('Remove service "' + name + '"?')) return;
			this.editorServices.splice(idx, 1);
		},

		addPort() {
			this.serviceForm.ports.push({ host: 0, container: 0, protocol: 'tcp' });
		},

		addVolume() {
			this.serviceForm.volumes.push({ source: '', target: '', read_only: false });
		},

		addEnvVar() {
			this.serviceForm.envList.push({ key: '', value: '' });
		},

		// ================================================================
		// Generate / Validate / Save
		// ================================================================

		async generateYaml() {
			if (this.editorServices.length === 0) return;
			this.generating = true;
			this.validationErrors = [];
			try {
				var resp = await fetch('/api/v1/manifests/generate', {
					method: 'POST',
					headers: this.headers(),
					body: JSON.stringify({
						services: this.editorServices,
						networks: this.activeSession?.networks || {},
						volumes: this.activeSession?.volumes || {},
						version: '3.8'
					})
				});
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to generate manifest'); }
				var result = await resp.json();
				this.generatedYaml = result.content || '';
				if (result.errors && result.errors.length > 0) {
					this.validationErrors = result.errors;
				}
				if (typeof usulnet !== 'undefined') usulnet.toast('YAML generated', 'success');
			} catch (e) {
				if (typeof usulnet !== 'undefined') usulnet.toast(e.message, 'error');
			} finally {
				this.generating = false;
			}
		},

		async generateFromList(session) {
			try {
				var resp = await fetch('/api/v1/manifests/sessions/' + session.id);
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to load session'); }
				var data = await resp.json();
				var services = this.parseServices(data.services);
				if (services.length === 0) {
					if (typeof usulnet !== 'undefined') usulnet.toast('Session has no services to generate', 'warning');
					return;
				}
				var genResp = await fetch('/api/v1/manifests/generate', {
					method: 'POST',
					headers: this.headers(),
					body: JSON.stringify({
						services: services,
						networks: data.networks || {},
						volumes: data.volumes || {},
						version: '3.8'
					})
				});
				if (!genResp.ok) { var eb = await genResp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to generate manifest'); }
				var result = await genResp.json();
				this.activeSession = data;
				this.editorServices = services;
				this.generatedYaml = result.content || '';
				this.validationErrors = (result.errors && result.errors.length > 0) ? result.errors : [];
			} catch (e) {
				if (typeof usulnet !== 'undefined') usulnet.toast(e.message, 'error');
			}
		},

		async validateYaml() {
			if (!this.generatedYaml) return;
			this.validating = true;
			this.validationErrors = [];
			try {
				var resp = await fetch('/api/v1/manifests/validate', {
					method: 'POST',
					headers: this.headers(),
					body: JSON.stringify({
						content: this.generatedYaml,
						format: this.activeSession?.format || 'compose'
					})
				});
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to validate manifest'); }
				var result = await resp.json();
				if (result.valid) {
					if (typeof usulnet !== 'undefined') usulnet.toast('Manifest is valid', 'success');
				} else {
					this.validationErrors = result.errors || [];
					if (typeof usulnet !== 'undefined') usulnet.toast('Validation found ' + this.validationErrors.length + ' issue(s)', 'warning');
				}
			} catch (e) {
				if (typeof usulnet !== 'undefined') usulnet.toast(e.message, 'error');
			} finally {
				this.validating = false;
			}
		},

		async saveAsStack() {
			if (!this.activeSession || !this.generatedYaml) return;
			this.savingStack = true;
			try {
				var resp = await fetch('/api/v1/manifests/sessions/' + this.activeSession.id + '/save', {
					method: 'POST',
					headers: this.headers()
				});
				if (!resp.ok) { var eb = await resp.json().catch(function() { return null; }); throw new Error((eb && eb.error) ? eb.error : 'Failed to save as stack'); }
				if (typeof usulnet !== 'undefined') usulnet.toast('Saved as stack successfully', 'success');
				this.activeSession.is_saved = true;
			} catch (e) {
				if (typeof usulnet !== 'undefined') usulnet.toast(e.message, 'error');
			} finally {
				this.savingStack = false;
			}
		},

		// ================================================================
		// Utilities
		// ================================================================

		parseServices(raw) {
			if (!raw) return [];
			try {
				var parsed = typeof raw === 'string' ? JSON.parse(raw) : raw;
				return Array.isArray(parsed) ? parsed : [];
			} catch (e) {
				return [];
			}
		},

		serviceCount(session) {
			try {
				var parsed = typeof session.services === 'string' ? JSON.parse(session.services) : (session.services || []);
				return Array.isArray(parsed) ? parsed.length : 0;
			} catch (e) {
				return 0;
			}
		},

		copyYaml() {
			if (!this.generatedYaml) return;
			navigator.clipboard.writeText(this.generatedYaml).then(function() {
				if (typeof usulnet !== 'undefined') usulnet.toast('Copied to clipboard', 'success');
			});
		}
	}`
}

var _ = templruntime.GeneratedTemplate
