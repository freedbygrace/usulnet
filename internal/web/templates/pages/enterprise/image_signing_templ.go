// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
// SPDX-License-Identifier: AGPL-3.0-or-later

// Copyright (c) 2024-2026 usulnet contributors

// https://github.com/fr4nsys/usulnet

package enterprise

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import "github.com/fr4nsys/usulnet/internal/web/templates/layouts"

// ImageSigningData holds all data for the image signing & verification page.
type ImageSigningData struct {
	PageData layouts.PageData
}

func ImageSigning(data ImageSigningData) templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, "<div x-data=\"")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			var templ_7745c5c3_Var3 string
			templ_7745c5c3_Var3, templ_7745c5c3_Err = templ.JoinStringErrs(imageSigningApp(data.PageData.CSRFToken))
			if templ_7745c5c3_Err != nil {
				return templ.Error{Err: templ_7745c5c3_Err, FileName: `internal/web/templates/pages/enterprise/image_signing.templ`, Line: 17, Col: 52}
			}
			_, templ_7745c5c3_Err = templ_7745c5c3_Buffer.WriteString(templ.EscapeString(templ_7745c5c3_Var3))
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 2, "\" class=\"space-y-6\"><!-- Header --><div class=\"flex items-center justify-between\"><div><h1 class=\"text-2xl font-display font-bold text-white\">Image Signing & Verification</h1><p class=\"text-gray-400 mt-1\">Verify image signatures and manage trust policies</p></div></div><!-- Tabs --><div class=\"space-y-4\"><div class=\"flex gap-1 border-b border-dark-600\"><button @click=\"tab = 'verify'\" :class=\"tab === 'verify' ? 'border-primary-500 text-white' : 'border-transparent text-gray-400 hover:text-gray-300'\" class=\"px-4 py-2 text-sm font-medium border-b-2 -mb-px transition-colors\"><i class=\"fas fa-check-double mr-2\"></i>Verify Image</button> <button @click=\"tab = 'policies'; loadPolicies()\" :class=\"tab === 'policies' ? 'border-primary-500 text-white' : 'border-transparent text-gray-400 hover:text-gray-300'\" class=\"px-4 py-2 text-sm font-medium border-b-2 -mb-px transition-colors\"><i class=\"fas fa-shield-alt mr-2\"></i>Trust Policies</button></div><!-- Verify Image Tab --><div x-show=\"tab === 'verify'\" x-cloak><div class=\"card p-6 space-y-6\"><!-- Input --><div><label class=\"block text-sm font-medium text-gray-300 mb-2\">Image Reference</label><div class=\"flex gap-3\"><input type=\"text\" x-model=\"imageRef\" class=\"input flex-1 font-mono\" placeholder=\"e.g. nginx:latest, registry.example.com/app:v1.2.3\" @keydown.enter.prevent=\"checkSignatures()\"> <button @click=\"checkSignatures()\" :disabled=\"!imageRef.trim() || sigLoading\" class=\"btn-primary flex items-center gap-2 whitespace-nowrap disabled:opacity-50\"><i class=\"fas fa-file-signature\" :class=\"sigLoading && 'animate-pulse'\"></i> Check Signatures</button> <button @click=\"verifyPolicies()\" :disabled=\"!imageRef.trim() || verifyLoading\" class=\"btn-secondary flex items-center gap-2 whitespace-nowrap disabled:opacity-50\"><i class=\"fas fa-shield-alt\" :class=\"verifyLoading && 'animate-pulse'\"></i> Verify Against Policies</button></div></div><!-- Signatures Results --><div x-show=\"signatures !== null\" x-cloak class=\"space-y-4\"><h3 class=\"text-lg font-medium text-white\"><i class=\"fas fa-file-signature mr-2 text-primary-400\"></i>Signatures</h3><template x-if=\"signatures && signatures.length === 0\"><div class=\"bg-dark-700 rounded-lg p-6 text-center\"><i class=\"fas fa-times-circle text-3xl text-yellow-400 mb-3\"></i><p class=\"text-gray-300\">No signatures found for this image</p><p class=\"text-sm text-gray-500 mt-1\">This image has not been signed or signatures are not accessible</p></div></template><template x-if=\"signatures && signatures.length > 0\"><div class=\"bg-dark-800 border border-dark-700 rounded-xl overflow-hidden\"><table class=\"w-full\"><thead><tr class=\"border-b border-dark-600\"><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Issuer</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Transparency Log ID</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Created At</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Signature Type</th></tr></thead> <tbody class=\"divide-y divide-dark-700\"><template x-for=\"sig in signatures\" :key=\"sig.transparency_log_id || sig.issuer\"><tr class=\"hover:bg-dark-700/50\"><td class=\"px-4 py-3\"><span class=\"text-sm text-white\" x-text=\"sig.issuer || 'Unknown'\"></span></td><td class=\"px-4 py-3\"><span class=\"text-sm text-gray-300 font-mono\" x-text=\"sig.transparency_log_id || '-'\"></span></td><td class=\"px-4 py-3\"><span class=\"text-sm text-gray-400\" x-text=\"sig.created_at || '-'\"></span></td><td class=\"px-4 py-3\"><span class=\"px-2 py-0.5 text-xs bg-dark-600 text-gray-300 rounded\" x-text=\"sig.signature_type || 'N/A'\"></span></td></tr></template></tbody></table></div></template></div><!-- Verification Results --><div x-show=\"verification !== null\" x-cloak class=\"space-y-4\"><h3 class=\"text-lg font-medium text-white\"><i class=\"fas fa-shield-alt mr-2 text-primary-400\"></i>Policy Verification</h3><!-- Overall Status --><div :class=\"verification && verification.allowed ? 'border-green-500/30 bg-green-500/5' : 'border-red-500/30 bg-red-500/5'\" class=\"border rounded-lg p-4 flex items-center gap-4\"><div :class=\"verification && verification.allowed ? 'bg-green-500/20' : 'bg-red-500/20'\" class=\"w-12 h-12 rounded-full flex items-center justify-center\"><i :class=\"verification && verification.allowed ? 'fa-check-circle text-green-400' : 'fa-times-circle text-red-400'\" class=\"fas text-xl\"></i></div><div><h4 :class=\"verification && verification.allowed ? 'text-green-400' : 'text-red-400'\" class=\"font-medium\" x-text=\"verification && verification.allowed ? 'Verification Passed' : 'Verification Failed'\"></h4><p class=\"text-sm text-gray-400\" x-text=\"verification && verification.matched_policies && verification.matched_policies.length > 0 ? 'Matched policies: ' + verification.matched_policies.join(', ') : 'No matching policies'\"></p></div></div><!-- Violations --><template x-if=\"verification && verification.violations && verification.violations.length > 0\"><div class=\"space-y-2\"><h4 class=\"text-sm font-medium text-red-400 flex items-center gap-2\"><i class=\"fas fa-times-circle\"></i>Violations</h4><template x-for=\"(violation, idx) in verification.violations\" :key=\"'v-' + idx\"><div class=\"bg-dark-700 rounded-lg p-3 flex items-center gap-3\"><i class=\"fas fa-times text-red-400\"></i> <span class=\"text-sm text-gray-300\" x-text=\"violation\"></span></div></template></div></template><!-- Warnings --><template x-if=\"verification && verification.warnings && verification.warnings.length > 0\"><div class=\"space-y-2\"><h4 class=\"text-sm font-medium text-yellow-400 flex items-center gap-2\"><i class=\"fas fa-exclamation-triangle\"></i>Warnings</h4><template x-for=\"(warning, idx) in verification.warnings\" :key=\"'w-' + idx\"><div class=\"bg-dark-700 rounded-lg p-3 flex items-center gap-3\"><i class=\"fas fa-exclamation-triangle text-yellow-400\"></i> <span class=\"text-sm text-gray-300\" x-text=\"warning\"></span></div></template></div></template></div><!-- Error --><div x-show=\"error\" x-cloak class=\"bg-red-500/10 border border-red-500/20 rounded-lg p-4 flex items-center gap-3\"><i class=\"fas fa-exclamation-circle text-red-400\"></i> <span class=\"text-red-400 text-sm\" x-text=\"error\"></span></div></div></div><!-- Trust Policies Tab --><div x-show=\"tab === 'policies'\" x-cloak class=\"space-y-4\"><!-- Actions --><div class=\"flex justify-end\"><button @click=\"seedPolicies()\" :disabled=\"seedLoading\" class=\"btn-secondary flex items-center gap-2 disabled:opacity-50\"><i class=\"fas fa-seedling\" :class=\"seedLoading && 'animate-pulse'\"></i> Seed Default Policies</button></div><!-- Loading --><div x-show=\"policiesLoading\" class=\"card p-12 text-center\"><i class=\"fas fa-spinner fa-spin text-2xl text-gray-400 mb-3\"></i><p class=\"text-gray-400\">Loading trust policies...</p></div><!-- Empty State --><div x-show=\"!policiesLoading && policies.length === 0\" x-cloak class=\"card p-12 text-center\"><i class=\"fas fa-shield-alt text-4xl text-gray-400 mb-4\"></i><h3 class=\"text-lg font-medium text-white mb-2\">No Trust Policies</h3><p class=\"text-gray-400 mb-4\">Trust policies define which signers are required for image verification</p><button @click=\"seedPolicies()\" :disabled=\"seedLoading\" class=\"btn-primary inline-flex items-center gap-2 disabled:opacity-50\"><i class=\"fas fa-seedling\"></i> Seed Default Policies</button></div><!-- Policies Table --><div x-show=\"!policiesLoading && policies.length > 0\" x-cloak class=\"bg-dark-800 border border-dark-700 rounded-xl overflow-hidden\"><table class=\"w-full\"><thead><tr class=\"border-b border-dark-600\"><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Policy Name</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Description</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Allowed Signers</th><th class=\"text-left text-xs font-medium text-gray-400 uppercase px-4 py-3\">Status</th></tr></thead> <tbody class=\"divide-y divide-dark-700\"><template x-for=\"policy in policies\" :key=\"policy.name || policy.id\"><tr class=\"hover:bg-dark-700/50\"><td class=\"px-4 py-3\"><span class=\"text-sm font-medium text-white\" x-text=\"policy.name\"></span></td><td class=\"px-4 py-3\"><span class=\"text-sm text-gray-400\" x-text=\"policy.description || '-'\"></span></td><td class=\"px-4 py-3\"><span class=\"text-sm text-gray-300 font-mono\" x-text=\"policy.allowed_signers && policy.allowed_signers.length > 0 ? policy.allowed_signers.join(', ') : 'Any'\"></span></td><td class=\"px-4 py-3\"><template x-if=\"policy.is_enforcing\"><span class=\"px-2 py-0.5 text-xs bg-red-500/20 text-red-400 rounded flex items-center gap-1 w-fit\"><i class=\"fas fa-lock text-[10px]\"></i>Enforcing</span></template><template x-if=\"!policy.is_enforcing\"><span class=\"px-2 py-0.5 text-xs bg-gray-500/20 text-gray-400 rounded\">Audit Only</span></template></td></tr></template></tbody></table></div></div></div></div>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = layouts.Base(data.PageData).Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

func imageSigningApp(csrfToken string) string {
	return `{
		tab: 'verify',
		imageRef: '',
		signatures: null,
		verification: null,
		error: '',
		sigLoading: false,
		verifyLoading: false,
		policies: [],
		policiesLoading: false,
		seedLoading: false,
		csrfToken: '` + csrfToken + `',

		async checkSignatures() {
			if (!this.imageRef.trim()) return;
			this.sigLoading = true;
			this.error = '';
			this.signatures = null;
			try {
				const resp = await fetch('/api/v1/images/signing/signatures?image=' + encodeURIComponent(this.imageRef.trim()));
				if (!resp.ok) {
					const body = await resp.json().catch(() => null);
					throw new Error((body && body.error) || 'Failed to fetch signatures (HTTP ' + resp.status + ')');
				}
				const body = await resp.json();
				this.signatures = body.signatures || body.data || body || [];
				if (!Array.isArray(this.signatures)) this.signatures = [];
			} catch (err) {
				this.error = err.message;
				if (window.usulnet && window.usulnet.toast) { window.usulnet.toast(err.message, 'error'); }
			} finally {
				this.sigLoading = false;
			}
		},

		async verifyPolicies() {
			if (!this.imageRef.trim()) return;
			this.verifyLoading = true;
			this.error = '';
			this.verification = null;
			try {
				const resp = await fetch('/api/v1/images/signing/verify?image=' + encodeURIComponent(this.imageRef.trim()));
				if (!resp.ok) {
					const body = await resp.json().catch(() => null);
					throw new Error((body && body.error) || 'Verification request failed (HTTP ' + resp.status + ')');
				}
				this.verification = await resp.json();
			} catch (err) {
				this.error = err.message;
				if (window.usulnet && window.usulnet.toast) { window.usulnet.toast(err.message, 'error'); }
			} finally {
				this.verifyLoading = false;
			}
		},

		async loadPolicies() {
			this.policiesLoading = true;
			try {
				const resp = await fetch('/api/v1/images/signing/trust-policies');
				if (!resp.ok) {
					const body = await resp.json().catch(() => null);
					throw new Error((body && body.error) || 'Failed to load trust policies');
				}
				const body = await resp.json();
				this.policies = body.policies || body.data || body || [];
				if (!Array.isArray(this.policies)) this.policies = [];
			} catch (err) {
				if (window.usulnet && window.usulnet.toast) { window.usulnet.toast(err.message, 'error'); }
			} finally {
				this.policiesLoading = false;
			}
		},

		async seedPolicies() {
			this.seedLoading = true;
			try {
				const resp = await fetch('/api/v1/images/signing/trust-policies/seed', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
						'X-CSRF-Token': this.csrfToken,
					},
				});
				if (!resp.ok) {
					const body = await resp.json().catch(() => null);
					throw new Error((body && body.error) || 'Failed to seed policies');
				}
				if (window.usulnet && window.usulnet.toast) { window.usulnet.toast('Default trust policies seeded', 'success'); }
				await this.loadPolicies();
			} catch (err) {
				if (window.usulnet && window.usulnet.toast) { window.usulnet.toast(err.message, 'error'); }
			} finally {
				this.seedLoading = false;
			}
		},
	}`
}

var _ = templruntime.GeneratedTemplate
